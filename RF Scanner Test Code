

Path = pwd;

for ch_ind = 1:Ch_Num
filename=[ Path '\'  File_name '_SET' num2str(set_ind,'%03.f') 'CH' num2str(ch_ind,'%02.f') '.dat'];

while 1
fileID = fopen(filename); % File Open

if fileID~=-1
LoggingData=fread(fileID,'uint16');
DataBuff(:,ch_ind) = LoggingData(1:end);
fclose all; % File ID Close
break;
end

fclose all; % File ID Close
pause(0.1);
end

end              
                           
Sam = Sam_Num*(St_Ram_16-1)+1:Sam_Num*(St_Ram_16 + Num_Ram_16 -1);
for i = 0:1
figure                              
for ch_ind =1:Ch_Num/2                                   
subplot(2,4,ch_ind)                                    
plot(Sam,DataBuff(Sam,ch_ind + 8*i))                               
xlabel('Sample')                                   
ylabel('Amplitude')                                  
title(['Raw data CH ' num2str(ch_ind + 8*i)])                                   
set(gca,'FontSize',15)                                
end
pause(P_time)                        
end

                                         
for ch_ind = 1:Ch_Num                            
Sam = Sam_Num*(Ram_FFT-1)+1:Sam_Num*Ram_FFT;
Data_RS_1D = DataBuff(Sam,ch_ind);
Data_RS_Sel_1D = Data_RS_1D(21:end);
FT_Sig_1D = fft(Data_RS_Sel_1D);
FT_Sig_1D(1) = [];
end

                      
for ch_ind = 1:Ch_Num
TestBuf(:,ch_ind) = FT_Sig_1D(:,ch_ind)>DecTh;                            
end

Detection = sum(TestBuf,[],"all");

if Detection >= 1
disp('Signal Detected')
end

for ch_ind = 1:Ch_Num

FreqAnt1 = fft(SelAnt1);
FreqAnt2=fft(SelAnt2);
                    

ConjMult_Ant2Ant1=FreqAnt1.*conj(FreqAnt2);
[Pos1 Pos2]=find(abs(ConjMult_Ant2Ant1)>DetTH);                   
SelBigVal=ConjMult_Ant2Ant1(Pos1);
SelBigVal_Degree=angle(SelBigVal)/pi*180;                  
MeanAngle=mean(SelBigVal_Degree);
                    
                    
if Indi_ResultOn
figure(FrameIdx);
subplot(2,2,1);
plot(abs(FreqAnt1)); legend('Freq of Ant1');
                        

subplot(2,2,2);
plot(abs(FreqAnt2), 'r'); legend('Freq of Ant2');                        
                        
subplot(2,2,3); 
plot(angle(ConjMult_Ant2Ant1)/pi*180); legend('Phase Difference of All in Freq');                        

subplot(2,2,4);
plot(real(SelAnt1)); hold on; plot(real(SelAnt2), 'r'); legend('Time of Real Ant1','Time of Real Ant2'); hold off;                                           
end


if Avg_ResultOn
figure(200); title('Averaged Angle of Frame')         
hold on; plot(FrameIdx, MeanAngle, 'ro'); axis([0 FrameEnd+1 -180 180]);
end


end 


                    
                    
